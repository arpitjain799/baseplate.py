#!/usr/bin/env python

# this is here and not just a console_script entry point because we want the
# gevent monkeypatching to happen before any pieces of baseplate are imported
# at all, as would happen if we were to have this code be in the baseplate
# package.

from gevent.monkey import patch_all

from baseplate.server.monkey import patch_stdlib_queues

patch_all()
patch_stdlib_queues()

# grpc gevent patching.
# only patch if server does have gRPC as a dependency as this is
# not needed for thrift or http only servers.
try:
    import grpc.experimental.gevent as grpc_gevent  # noreorder
    grpc_gevent.init_gevent()
except ImportError:
    pass

from baseplate.server import load_and_run_shell

load_and_run_shell()
